<%= turbo_frame_tag "prompt_form" do %>
  <%# prefer a passed-in local, then @prompt, else new prompt object %>
  <% model = local_assigns[:prompt] || defined?(@prompt) && @prompt || Prompt.new %>

  <%= form_with url: prompts_path, scope: :prompt, method: :post, local: false, class: "..." do |f| %>
    <div class="mb-3">
      <%= f.label :idea, "Your idea", class: "block text-sm font-medium text-gray-700" %>
      <%= f.text_area :idea,
            value: (@previous_input && @previous_input[:idea]) || params.dig(:prompt, :idea) || f.object.try(:idea) || "",
            rows: 6,
            class: "w-full border p-2 rounded" %>
    </div>

    <div class="flex gap-2 mb-3">
      <div class="flex-1">
        <%= f.select :category,
              ["Writing", "Marketing", "Code", "Other"],
              { include_blank: "Category" },
              class: "w-full border p-2 rounded",
              selected: (@previous_input && @previous_input[:category]) || f.object.try(:category) %>
      </div>

      <div class="w-1/3">
        <%= f.select :tone,
              ["Formal", "Informal", "Friendly"],
              { include_blank: "Tone" },
              class: "w-full border p-2 rounded",
              selected: (@previous_input && @previous_input[:tone]) || f.object.try(:tone) %>
      </div>

      <div class="w-1/3">
        <%= f.select :format,
              ["Paragraph", "Bullet list", "Steps"],
              { include_blank: "Format" },
              class: "w-full border p-2 rounded",
              selected: (@previous_input && @previous_input[:format]) || f.object.try(:format) %>
      </div>
    </div>

    <div class="flex items-center justify-between">
      <div class="text-sm text-gray-500">Model: General</div>
      <div><%= f.submit "Generate Prompt", class: "px-4 py-2 bg-brand text-white rounded hover:bg-brand/80 transition-colors duration-200 cursor-pointer" %></div>
    </div>
  <% end %>
<% end %>
